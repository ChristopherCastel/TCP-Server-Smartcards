/*
 * main.cpp
 *
 *  Created on: 28 Feb 2019
 *      Author: Castel Christopher
 */

#include "constants/request_code.h"
#include "client/client_api.h"
#include "client/requests/command.h"
#include "client/requests/diag.h"
#include "client/requests/disconnect.h"
#include "client/requests/echo.h"
#include "client/requests/request.h"
#include "client/requests/flyweight_requests.h"
#include "terminal/flyweight_terminal_factory.h"
#include "terminal/terminals/terminal_pcsc.h"

using namespace client;

int __cdecl main(void) {
	// config available terminal factories
	FlyweightTerminalFactory available_terminals;
	ITerminalFactory* pcscFactory = new PCSCFactory();
	available_terminals.addFactory("PCSC", pcscFactory);

	// config requests client can handle
	FlyweightRequests available_requests;
	IRequest* command = new Command();
	available_requests.addRequest(REQ_COMMAND, command);
	IRequest* diag = new Command();
	available_requests.addRequest(REQ_DIQG, diag);
	IRequest* disconnect = new Command();
	available_requests.addRequest("DISCONNECT", disconnect);
	IRequest* echo = new Command();
	available_requests.addRequest("ECHO", echo);

	ClientAPI client;
	client.initClient("./config/init.json", available_terminals, available_requests);
	client.connectClient();
	return 0;
}
